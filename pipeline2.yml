steps:
- label: ":rocket: Build"
  command: "echo 'job id is $BUILDKITE_JOB_ID and build id is $BUILDKITE_BUILD_ID'"
  key: 'one'

- label: ":rocket: Build"
  command: "echo \"Organization slug is $BUILDKITE_ORGANIZATION_SLUG\""
  key: 'two'

- label: ":cow: dynamic pipeline"
  command: | # Here we define a multi-line command with |
    if [ "$(buildkite-agent step get "outcome" --step "two")" == "passed" ]; then
      cat << 'YAML' | buildkite-agent pipeline upload  # Heredoc starts here
        steps:  # Make sure this line and all within are indented the same
          - label: "Notify slack about soft failed step"
            command: echo 'Notifying slack about the soft_failed step'
            notify:
              - github_commit_status:
                  context: "my-custom-status-2-failed"
      YAML  # Heredoc ends here, ensure no extra characters before YAML
    fi  # `fi` closes the if statement:
